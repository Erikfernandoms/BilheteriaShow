# O desafio üéØ

Este projeto √© a entrega do **case t√©cnico para vaga de Engenheiro de Software S√™nior no Ita√∫ Unibanco**, onde foi solicitado o desenvolvimento do seguinte desafio:

Voc√™ dever√° propor uma arquitetura na AWS e desenvolver uma solu√ß√£o funcional (em sua stack de prefer√™ncia) para um sistema de bilhetagem com as seguintes caracter√≠sticas:

O sistema deve permitir solicita√ß√£o, reserva e compra de ingressos.
Durante o processo de compra, o sistema deve oferecer produtos adicionais como pipoca, chocolate, refrigerante, etc.
A solu√ß√£o deve conter uma √∫nica base de c√≥digo (um √∫nico projeto/solution), mesmo que a arquitetura proposta seja orientada a microservi√ßos. Isso facilitar√° a apresenta√ß√£o e a avalia√ß√£o do seu trabalho.
 
üõ†Ô∏è O que esperamos:

Um desenho de arquitetura AWS (pode ser feito com ferramentas como Lucidchart, Draw.io, ou similar).
C√≥digo-fonte funcional com instru√ß√µes claras de como rodar o projeto. (Pode ser compartilhado um reposit√≥rio GitHub pessoal, ou o envio do c√≥digo por e-mail).
Documenta√ß√£o breve explicando suas decis√µes t√©cnicas.

---


# Arquitetura AWS:
![alt text](<images/ArquiteturaAWS.jpg>)


## ‚òÅÔ∏è Servi√ßos AWS Utilizados

| Servi√ßo           | Finalidade                                                  |
|-------------------|-------------------------------------------------------------|
| S3 + CloudFront   | Hospedagem do Microfrontend com caching e performance       |
| API Gateway (BFF) | Interface √∫nica de acesso aos microsservi√ßos                |
| ECS (Fargate)     | Execu√ß√£o dos servi√ßos backend (pedidos, eventos etc.)       |
| RDS PostgreSQL    | Banco relacional com transa√ß√µes ACID                        |
| RDS Proxy         | Multiplexa√ß√£o segura das conex√µes ao banco                  |
| EventBridge       | Expira√ß√£o autom√°tica de reservas                            |
| Lambda            | Gera√ß√£o de NFe e expira√ß√£o de pedidos                       |
| Cognito           | Autentica√ß√£o e autoriza√ß√£o de usu√°rios                      |
| WAF + Shield      | Prote√ß√£o contra ataques como DDoS e SQL Injection           |
| CloudWatch + X-Ray| Observabilidade e tracing distribu√≠do                       |
| QuickSight        | Dashboards anal√≠ticos via RDS replica ou arquivos do S3     |

---

## üè¶ Alinhamento com o Modelo Arquitetural do Ita√∫

A solu√ß√£o foi estruturada com base no modelo de arquitetura do Ita√∫ Unibanco, dividido em tr√™s camadas: **Core**, **Experi√™ncia** e **Canais Digitais**. Essa abordagem promove clareza de responsabilidades, consist√™ncia entre camadas e confiabilidade para escalar com seguran√ßa.

---

### üî∂ Camada Core ‚Äî *‚ÄúCora√ß√£o do neg√≥cio‚Äù*  
> Onde vivem as regras cr√≠ticas, transa√ß√µes e a persist√™ncia confi√°vel dos dados.

- Aplica regras de neg√≥cio como confirma√ß√£o de pedidos e gera√ß√£o de nota fiscal.  
- Garante consist√™ncia e integridade dos dados com transa√ß√µes ACID no PostgreSQL.  
- Desacoplada dos canais, foca na robustez da l√≥gica central.  
- Altamente dispon√≠vel com RDS Multi-AZ, Proxy e Read Replica.

**üîß Pilar da Engenharia**  
- Arquitetura modular e escal√°vel com uso das melhores pr√°ticas AWS.  
- Robustez transacional com PostgreSQL e controle de concorr√™ncia.  
- Observabilidade implementada com logs, m√©tricas e tracing distribu√≠do (X-Ray).

---

### üüß Camada de Experi√™ncia ‚Äî *‚ÄúOnde a jornada do cliente acontece‚Äù*  
> Traduz regras de neg√≥cio em experi√™ncias flu√≠das, claras e eficientes.

- Implementada com ECS + API Gateway (BFF), conectando servi√ßos com simplicidade.  
- Abstrai a complexidade do core com APIs REST bem definidas e documentadas.  
- Garante fluidez na jornada de reserva, confirma√ß√£o de ingressos e compra de produtos.

**üöÄ Pilar da Transforma√ß√£o**  
- Arquitetura pronta para evolu√ß√£o, com camada desacoplada de gera√ß√£o de NFe.  
- Simula√ß√£o local por CLI para desenvolvimento √°gil e testes r√°pidos.  
- Preparada para integra√ß√£o com camadas anal√≠ticas e de insights via SOR.

---

### üü® Camada de Canais Digitais ‚Äî *‚ÄúContato direto com o cliente‚Äù*  
> Respons√°vel por entregar a experi√™ncia final nos canais web e mobile.

- Microfrontend hospedado em S3 + CloudFront, com autentica√ß√£o via Cognito.  
- Prote√ß√£o com WAF e AWS Shield contra ataques e acesso indevido.  
- Coleta de comportamento e preparada para an√°lises via QuickSight.

**üë• Pilar de Pessoas**  
- Organiza√ß√£o clara para facilitar o onboarding e a colabora√ß√£o entre times.  
- Testes de integra√ß√£o e documenta√ß√£o completa garantem seguran√ßa no ciclo de entrega.  
- Frontend desacoplado permite m√∫ltiplos canais com experi√™ncia unificada.

---

### üß± Backend (ECS Fargate)
- `eventos-api-service`: gerenciamento de eventos e setores
- `produtos-api-service`: gerenciamento de produtos adicionais
- `usuarios-api-service`: login e autentica√ß√£o de usu√°rios
- `pedidos-api-service`: solicita√ß√µes, reservas e finaliza√ß√µes
- `pagamento-api-service`: controle do fluxo de pagamentos

Funcionalidades como gera√ß√£o de nota fiscal e expira√ß√£o s√£o tratadas por Lambdas desacopladas.

#### Por que da decis√£o?
- M√∫ltiplas APIs REST estruturadas por dom√≠nio (ex: /eventos, /pedidos, /pagamentos)
- Controle de infraestrutura sem gerenciar servidores
- Escalabilidade horizontal, mas com l√≥gica de neg√≥cio interdependente
- Conex√£o com RDS PostgreSQL (transacional) via RDS Proxy
- Custo previs√≠vel
- Observabilidade, seguran√ßa e f√°cil manuten√ß√£o

---

### üóÉÔ∏è Banco de Dados
- **PostgreSQL via Amazon RDS**
- Modelagem relacional com as entidades j√° definidas e modeladas!
- RDS Proxy para controle de conex√µes simult√¢neas
- Read Replica para relat√≥rios anal√≠ticos e separa√ß√£o de carga

#### Por que da decis√£o?
- PostgreSQL tem controle de transa√ß√µes mais robusto que o MySQL, com melhores garantias ACID e suporte a isolamento de transa√ß√µes com granularidade maior.
- Controle de concorr√™ncia essencial para reservas e pagamentos
- RDS Proxy evita explos√£o de conex√µes com ECS
- Failover simples via Multi-AZ
- Rastreabilidade e auditoria fiscal com os relacionamentos entre entidades
- Melhor equil√≠brio entre custo, robustez e escalabilidade (Comparado ao Aurora Serveless por exemplo)

---

### üßæ Fluxos Adicionais Descoplados
#### **Nota fiscal:** Lambda + SNS ‚Üí JSON salvo em bucket S3 + envio via email/SMS
- Fluxo desacoplado para gera√ß√£o de nota fiscal p√≥s pagamento
- Menor custo
- Permite qualquer consumidor escutar o SNS de notifica√ß√£o caso precise (por ex. siglas contabeis)
- Garante auditoria e contingencia espec√≠fica sem mexer no motor de neg√≥cio central (ECS)

#### **Expira√ß√£o:** EventBridge programado + Lambda ‚Üí atualiza status em caso de inatividade
- Fluxo desacoplado para expirar as reservas que n√£o cumpriram o prazo estimado
- Economia de recursos
- Role restrita para ler e atualizar s√≥ a tabela de pedidos
- Escalabilidade controlada

---

### API Gateway (BFF)
#### Por que da decis√£o?
- Ponto √∫nico de entrada para o front end (mobile e web..)
- Seguran√ßa
- Abstra√ß√£o das camadas
- Orquestra√ß√£o e escalabilidade separada
- Padroniza√ß√£o de interfa√ße

---

### üß© Frontend (Microfrontend)
- Hospedado em **S3 + CloudFront** com criptografia em repouso
- Autentica√ß√£o via **Cognito** com JWT
- Distribu√≠do via **Cloudfront**
- Prote√ß√£o com **WAF** e acesso via HTTPS com **ACM**
- **AWS Shield** contra DDoS

#### Por que da decis√£o?
- Autentica√ß√£o segura
- MFE Simples e escal√°vel
- Global com prote√ß√£o contra DDoS e SQL Injection
- Compat√≠vel com Web e Mobile

---

### üîç Observabilidade
- **ClouWatch Logs** Armazena logs dos containers ECS e Lambdas
- **ClouWatch Metrics** M√©tricas como uso de CPU, requisi√ß√µes, tempo de resposta, falhas e de comportamento dos clientes (ex. quantidade de pedidos)
- **ClouWatch Alarms** Detec√ß√£o de anomalias (ex: 5xx em excesso, tempo de resposta alto)
- **ClouWatch X-ray**  Tracing completo entre APIs ECS, Lambdas e chamadas externas
- Preparado para integra√ß√£o com **QuickSight** (SOR)

#### Por que da decis√£o?
- Garantir visibilidade completa sobre cada ponto da jornada de experiencia do cliente
- Garantir visibilidade da performance do sistema
- Medir e entender o comportamento do cliente

---

### üìä Rela√ß√£o entre N√∫mero de Usu√°rios e Custo (Arquitetura AWS)

| N¬∫ de Usu√°rios | Custo Mensal (USD) | Custo Anual (USD) |
|----------------|--------------------|-------------------|
| 100            | $594.87            | $7,138.44         |
| 1.000          | $694.48            | $8,333.76         |
| 10.000         | $1,255.49          | $15,065.88        |

---

## üéüÔ∏è BilheteriaShow ‚Äì Sistema de Bilhetagem de Show's

Sistema de bilhetagem completo para eventos, desenvolvido em Python com uma arquitetura limpa e escal√°vel, utilizando FastAPI no backend, SQLite como banco de dados local e uma interface baseada em terminal (CLI).

---

## üß± Funcionalidades
- Cadastro e listagem de eventos, produtos e setores
- Criptografia de senha
- Sistema de reservas com bloqueio tempor√°rio (15 minutos)
- Assentos numerados (cadeiras) e setores de pista
- Adi√ß√£o de produtos opcionais ao pedido
- Pagamento com simula√ß√£o de diferentes m√©todos (PIX, cart√£o, boleto)
- Gateway de integra√ß√£o com documenta√ß√£o no swagger (OpenAPI)
- Gera√ß√£o de nota fiscal simulada via json
- Expira√ß√£o autom√°tica de reservas pendentes
- Estrutura modular por dom√≠nio (eventos, usu√°rios, pedidos, produtos, pagamento)
- Testes unit√°rios e de integra√ß√£o com pytest
- CI com GitHub Actions
- Banco de dados SQLite (sem ORM, queries puras)
- Interface totalmente baseada em terminal
- Gera√ß√£o de logs
- Coleta de m√©tricas de uso (acessos a setores, pedidos por status)

---

## üß± Arquitetura e Estrutura

A aplica√ß√£o foi modelada com uma arquitetura MVC, simulando uma API de microservi√ßos e uma interface via terminal, atuando como frontend simulador.

```
BilheteriaShow/
‚îÇ
‚îú‚îÄ‚îÄ app/                  # L√≥gica do sistema
‚îÇ   ‚îú‚îÄ‚îÄ controllers/      # Regras de neg√≥cio (pedidos, eventos, produtos, etc)
‚îÇ   ‚îú‚îÄ‚îÄ interface/        # Interface de usu√°rio via terminal
‚îÇ   ‚îú‚îÄ‚îÄ jobs/             # A√ß√µes autom√°ticas em segundo plano, como expira√ß√£o de pedidos
‚îÇ   ‚îú‚îÄ‚îÄ models/           # Modelos de dados dos dom√≠nios
‚îÇ   ‚îú‚îÄ‚îÄ repositories /    # Camada de abstra√ß√£o para comunica√ß√£o com o bando de dados       
‚îÇ   ‚îú‚îÄ‚îÄ tests /           # Testes unit√°rios
‚îÇ
‚îú‚îÄ‚îÄ database/             # Conex√£o SQLite + cria√ß√£o da modelagem de dados
‚îú‚îÄ‚îÄ logs/                 # Output dos logs e m√©tricas do sistema
‚îú‚îÄ‚îÄ notas_fiscais/        # Output da gera√ß√£o de NF
‚îú‚îÄ‚îÄ tests/                # Testes de integra√ß√£o (TaaC)
‚îú‚îÄ‚îÄ bilhetagem.db         # Banco SQLite local (gerado automaticamente)
‚îú‚îÄ‚îÄ logger.py             # Log das opera√ß√µes
‚îú‚îÄ‚îÄ main.py               # Interface principal de navega√ß√£o (CLI)
‚îú‚îÄ‚îÄ run.py                # Gera√ß√£o do servidor do FastApi integrado com Swagger
‚îú‚îÄ‚îÄ metrics.py            # Coleta de m√©tricas de uso
‚îú‚îÄ‚îÄ requirements.txt      # Depend√™ncias Python
‚îî‚îÄ‚îÄ 
```

---

## üöÄ Como Executar

### 1. Clone o projeto
```bash
git clone <<<REPO>>>
cd BilheteriaShow
```

### 2. Crie um ambiente virtual (recomendado)
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate   # Windows
```

### 3. Instale as depend√™ncias
```bash
pip install -r requirements.txt
```

### 4. Execute o servidor de hospedagem FastAPI
```bash
uvicorn run:app --reload
```

### 5. Execute a interface do sistema
```bash
python main.py
```

---

## üöÄ Documenta√ß√£o da API (FastAPI) no OpenAPI
![alt text](images/image.png)


### 1. Depois de executar o servidor do FastAPI
```bash
uvicorn run:app --reload
```

### 2. Entre em:
```
http://localhost:8000/docs
```

---

## üöÄ Valide a esteiras automatizadas de testes (CI) p√≥s commits

![alt text](images/image-ci.png)
---
## üß† Funcionalidades

- Autentica√ß√£o de usu√°rios (simples via ID e nome)
- Listagem de eventos e setores
- Reserva tempor√°ria de ingressos (15 minutos)
- Adi√ß√£o de produtos adicionais √† compra (ex: pipoca, refrigerante)
- Gera√ß√£o de pedidos com persist√™ncia
- Expira√ß√£o autom√°tica de reservas n√£o finalizadas
- Visualiza√ß√£o de pedidos
- Emiss√£o de notas fiscais (simulada)
- Coleta de m√©tricas de uso (acessos a setores, pedidos por status)

---

## üõ†Ô∏è Diferenciais T√©cnicos

- Replica√ß√£o da arquietura AWS em c√≥digo (CLI sendo o canal, FastApi sendo o BFF com a camada de experi√™ncia + core)
- **Concorr√™ncia controlada** na reserva de ingressos com transa√ß√µes
- **Thread background** para limpeza de pedidos expirados
- Modulariza√ß√£o clara entre controle, interface e banco
- Arquitetura facilmente port√°vel para um backend FastAPI real
- Cobertura de testes de integra√ß√£o para simular jornada completa
- Criptografia de dados
- Esteira de CI no GitHub para rodar testes automatizados e garantir a integridade do c√≥digo

---

## üìå Considera√ß√µes

- Todo o c√≥digo simula um comportamento real de microservi√ßos e API Gateway por meio de organiza√ß√£o de m√≥dulos, que foi or√ßado na arquitetura AWS incial.

---


## ‚úçÔ∏è Autor

**Erik Mendes**  
Engenheiro de Software  
üîó linkedin.com/in/erikfernandoms

